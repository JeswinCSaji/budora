{% extends 'admin/base1.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/dashlegal.css' %}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="container-fluid" class="card-title mb-4" style="padding-bottom:5%;">
    <h2 style="color: white; text-shadow: rgba(1, 1, 1, 0.25) 0px 14px 28px, rgba(1, 1, 1, 0.22) 0px 3px 3px;">Licence Approval</h2>
    <div class="card" style="border-style: none; box-shadow: black 0px 20px 30px -10px;">
        <div class="card-body">

            <div id="indiv">
                <label for="status-filter" class="filter-label">Filter by status:</label>
                <select id="status-filter" class="filter-select">
                    <option value="all">All</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                    <option value="pending">Pending</option>
                </select>
                <br>
                <br>
                <!-- Search form -->
                <form class="search-form" id="searchform">
                    <label for="name" class="search-label">Search by name:</label>
                    <input type="text" id="name" name="name" class="search-input">
                    <button type="submit" class="search-button">Search</button>
                </form>
                <br>
                <br>
            </div>
            <p id="no-application-message" style="display: none;">No matching applications</p>
            <table class="application-list">
                <thead>
                    <tr>
                        {% comment %} <th>Application ID</th> {% endcomment %}
                        <th>Owner Name</th>
                        <th>Store Name</th>
                        <th>Expiry Date (From)</th>
                        <th>Expiry Date (To)</th>
                        <th>File</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in seller_applications %}
                    <tr>
                        {% comment %} <td>{{ application.id }}</td> {% endcomment %}
                        <td>{{ application.owner_name }}</td>
                        <td>{{ application.store_name }}</td>
                        <td>{{ application.expiry_date_from }}</td>
                        <td>{{ application.expiry_date_to }}</td>
                        <td>
                            {% if application.certification_image %}
                            <a href="{{ application.certification_image.url }}" target="_blank">View File</a>
                            {% else %}
                            No File Available
                            {% endif %}
                        </td>
                        <td id="status-cell-1">
                          {% if application.is_approved == 'pending' %}
                            <span style="font-weight: bolder; font-size: large; color:orange;" >Pending</span>
                          {% elif application.is_approved == 'approved' %}
                            <span class="text-success" style="font-weight: bolder;font-size: large;" >Approved</span>
                          {% elif application.is_approved == 'rejected' %}
                            <span class="text-danger" style="font-weight: bolder;font-size: large;" >Rejected</span>
                          {% else %}
                            <p> Not working </p>
                          
                          {% endif %}
                        </td>
                        <td id="status-cell-1"  style="padding:20">
                        <div class="approval-status">                   
                      {% if application.is_approved == 'pending' %}
                      <form method="post" action="{% url 'approve_certification' application.id %}">
                        {% csrf_token %}
                        <button class="btn btn-success approve-btn" type="submit" >Approve</button>
                    </form>
                    <form method="post" action="{% url 'reject_certification' application.id %}">
                        {% csrf_token %}
                        <button class="btn btn-danger reject-btn" type="submit">Reject</button>
                    </form>
                      {% elif application.is_approved == 'approved' %}
                         
                          <form method="post" action="{% url 'reject_certification' application.id %}">
                            {% csrf_token %}
                            <button class="btn btn-danger reject-btn" type="submit">Reject</button>
                        </form>
                      {% elif application.is_approved == 'rejected' %}
                         
                          <form method="post" action="{% url 'approve_certification' application.id %}">
                              {% csrf_token %}
                              <button class="btn btn-success approve-btn" type="submit">Approve</button>
                          </form>
                      {% else %}
                        <p> Not working </p>
                          
                      {% endif %}
                            <div class="approval-message"></div>
                        
                      </div>            
                      </td>      
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const input = document.querySelector('#name');
    const roleFilter = document.querySelector('#status-filter');
    const rows = document.querySelectorAll('.application-list tbody tr');
    const noUserMessage = document.querySelector('#no-application-message');

    input.addEventListener('input', filterUsers);
    roleFilter.addEventListener('change', filterUsers);

    function filterUsers() {
        const searchTerm = input.value.toLowerCase();
        const selectedRole = roleFilter.value;
        let found = false; // Flag to track if a matching user is found

        rows.forEach(function (row) {
            const username = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
            const role = row.querySelector('td:nth-child(6)').textContent.toLowerCase();

            // Check if the user matches the selected role (or if all roles are selected)
            if ((selectedRole === 'all' || role.includes(selectedRole)) &&
                (searchTerm.length === 0 || username.includes(searchTerm))) {
                row.style.display = 'table-row';
                found = true; // Matching user found
            } else {
                row.style.display = 'none';
            }
        });

        // Show/hide "No such user" message
        if (found) {
            noUserMessage.style.display = 'none';
        } else {
            noUserMessage.style.display = 'block';
        }
    }
});
</script>
{% endblock %}
</html>
