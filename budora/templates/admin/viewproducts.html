{% extends 'admin/base1.html' %}
{% load static %}
<html>
<head>
  <title>Admin Dashboard</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<script>
  $(document).ready(function() {
    $('.delete-btn').click(function() {
        var productId = $(this).data('id');
        if (confirm('Are you sure you want to delete this product?')) {
            $.ajax({
                type: 'POST',
                url: `/delete_product/${productId}/`,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}', // Include the CSRF token
                },
                success: function(response) {
                    // Handle success, e.g., remove the row from the table
                    $('#status-cell-' + productId).closest('tr').remove();
                },
            });
        }
    });
});

</script>
<style>
    #dlbtn {
        display: inline-block;
       
        background-color: #27350F; /* Button background color */
        color: #fff; /* Button text color */
        /* border: none; */
        border-radius: 4px;
        width: 80px;
        height: 37px;
        text-align: center;
        text-decoration: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      
      #dlbtn:hover {
        background-color: white; 
      
        border-color: #27350F;
        border-width: 2px;/* Button background color on hover */
      }
</style>
<body>
  {% block content %}
  <link rel="stylesheet" href="{% static 'css/viewproducts.css' %}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    
      <div class="container-fluid" class="card-title mb-4" style="padding-bottom:5%;" >
        <h5 id="regtitle">View Products</h5>
        <div class="card" style="border-style: none; box-shadow: black 0px 20px 30px -10px;">
          <div class="card-body">
            <div class="container mt-4">
                <div id="indiv" >
                    <label for="role-filter" class="filter-label" >Filter by Category:</label>
                    <select id="role-filter" class="filter-select">
                        <option value="all">All</option>
                        <option value="tabletop plants">TableTop</option>
                        <option value="floor plants">Floor Plants</option>
                        <option value="hanging plants">Hanging</option>
                    </select>
                    <br>
                    <br>
                    <!-- Search form -->
                    <form  class="search-form" id="searchform">
                      <label for="username" class="search-label">Search by Plant Name:</label>
                      <input type="text" id="username" name="username" class="search-input">
                      <button type="submit" class="search-button">Search</button>
                    </form>
                    <br>
                    <br>
                  </div>
                    <p id="no-user-message" style="display: none;">No such Plants</p>
                <table class="user-list">
                    <thead>
                        <tr>
                            <th style="font-weight: bold;">Plant Name</th>
                            <th style="font-weight: bold;">Plant Description</th>
                            <th style="font-weight: bold;">Category</th>
                            <th style="font-weight: bold;">Price</th>
                            <th style="font-weight: bold;">Stock</th>
                            <td style="font-weight: bold;">{{ product.product_stock }} KG</td>
                            <th style="font-weight: bold;">Image</th>
                            <th style="font-weight: bold;">Seller</th> <!-- Add a new column for the seller -->
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in all_products %}
                            <tr>
                                <td>{{ product.product_name }}</td>
                                <td>{{ product.product_description }}</td>
                                <td>{{ product.category.category_name }}</td>
                                <td>${{ product.product_price }}</td>
                                <td>{{ product.product_stock }}</td>
                                <td>
                                    {% if product.product_image %}
                                        <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}" width="100">
                                    {% else %}
                                        No image available
                                    {% endif %}
                                </td>
                                <td>{{ product.seller.user.username }}</td> <!-- Display the seller's username or appropriate field -->
                                <td>
                                    <a id="dlbtn" href="{% url 'delete_product' product.id %}" class="btn btn-primary btn-sm btn-action" style="background-color:red; border-style:none;">Delete</a>
                                    {% comment %} <a id="dlbtn" href="{% url 'update_product' product.id %}" class="btn btn-primary btn-sm btn-action" style="background-color:green; border-style:none;">Update</a> {% endcomment %}

                                    {% comment %} <form method="post" action="{% url 'delete_product' product.id %}">
                                        {% csrf_token %}
                                        <button type="submit" id="dlbtn" class="delete-btn" style="">Delete</button>
                                    </form> {% endcomment %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="6">No products available.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>       
            </div>
            
          </div>
        </div>
      </div>
      <script>
  
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.querySelector('#username');
            const roleFilter = document.querySelector('#role-filter');
            const rows = document.querySelectorAll('.user-list tbody tr');
            const noUserMessage = document.querySelector('#no-user-message');
        
            input.addEventListener('input', filterUsers);
            roleFilter.addEventListener('change', filterUsers);
        
            function filterUsers() {
                const searchTerm = input.value.toLowerCase();
                const selectedRole = roleFilter.value;
                let found = false; // Flag to track if a matching user is found
        
                rows.forEach(function (row) {
                    const username = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                    const role = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
        
                    // Check if the user matches the selected role (or if all roles are selected)
                    if ((selectedRole === 'all' || role.includes(selectedRole)) &&
                        (searchTerm.length === 0 || username.includes(searchTerm))) {
                        row.style.display = 'table-row';
                        found = true; // Matching user found
                    } else {
                        row.style.display = 'none';
                    }
                });
        
                // Show/hide "No such user" message
                if (found) {
                    noUserMessage.style.display = 'none';
                } else {
                    noUserMessage.style.display = 'block';
                }
            }
        });
    </script>

    {% endblock %}

</body>

</html>